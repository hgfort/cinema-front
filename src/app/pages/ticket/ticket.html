<div class="ticket-page" [class.print-mode]="isPrintMode">
  <div class="container">
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    @if (!isPrintMode) {
      <div class="page-header">
        <button class="back-btn" (click)="goToAccount()">
          ‚Üê –í –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
        </button>
        <h1>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –±–∏–ª–µ—Ç</h1>
      </div>
    }
    
    @if (isLoading) {
      <div class="loading">
        <div class="spinner"></div>
        <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –±–∏–ª–µ—Ç...</p>
      </div>
    }
    
    @if (errorMessage) {
      <div class="error-message">
        <h3>{{ errorMessage }}</h3>
        <a class="btn" routerLink="/account">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞–±–∏–Ω–µ—Ç</a>
      </div>
    }
    
    @if (ticket && booking && !isLoading && !errorMessage) {
      <div class="ticket-container">
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –±–∏–ª–µ—Ç -->
        <div class="ticket-main">
          <div class="ticket-header">
            <div class="cinema-info">
              <h2>–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä "–ü—Ä–µ–º–∏—É–º"</h2>
              <p class="cinema-address">–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è, 1</p>
              <p class="cinema-phone">+7 (495) 123-45-67</p>
            </div>
            
            <div class="ticket-status">
              <div class="status-badge" [class.active]="booking.status === 'active'" 
                                     [class.cancelled]="booking.status === 'cancelled'">
                {{ booking.status === 'active' ? '–ü–û–î–¢–í–ï–†–ñ–î–ï–ù' : '–û–¢–ú–ï–ù–ï–ù' }}
              </div>
            </div>
          </div>
          
          <div class="ticket-content">
            <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∏–ª—å–º–µ -->
            <div class="ticket-left">
              <div class="movie-info">
                <h3 class="movie-title">{{ getSessionInfo(booking.sessionId).filmTitle }}</h3>
                
                <div class="session-details">
                  <div class="detail-row">
                    <span class="label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</span>
                    <span class="value">{{ formatDateTime(getSessionInfo(booking.sessionId).dateTime) }}</span>
                  </div>
                  
                  <div class="detail-row">
                    <span class="label">–ó–∞–ª:</span>
                    <span class="value">{{ getSessionInfo(booking.sessionId).hallName }}</span>
                  </div>
                  
                  <div class="detail-row">
                    <span class="label">–§–æ—Ä–º–∞—Ç:</span>
                    <span class="value">{{ getSessionInfo(booking.sessionId).format }}</span>
                  </div>
                  
                  <div class="detail-row">
                    <span class="label">–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:</span>
                    <span class="value age-rating">16+</span>
                  </div>
                </div>
              </div>
              
              <div class="user-info">
                <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ</h4>
                <div class="detail-row">
                  <span class="label">–§–ò–û:</span>
                  <span class="value">{{ getUserInfo(booking.userId).name }} {{ getUserInfo(booking.userId).surname }}</span>
                </div>
                <div class="detail-row">
                  <span class="label">Email:</span>
                  <span class="value">{{ getUserInfo(booking.userId).email }}</span>
                </div>
              </div>
            </div>
            
            <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: QR-–∫–æ–¥ –∏ –¥–∞–Ω–Ω—ã–µ –±–∏–ª–µ—Ç–∞ -->
            <div class="ticket-right">
              <div class="qr-code">
                <img [src]="getQrCodeUrl()" alt="QR-–∫–æ–¥ –±–∏–ª–µ—Ç–∞">
                <p class="qr-hint">–ü–æ–∫–∞–∂–∏—Ç–µ QR-–∫–æ–¥ –Ω–∞ –≤—Ö–æ–¥–µ</p>
              </div>
              
              <div class="ticket-data">
                <div class="ticket-number">
                  <span class="label">–ù–æ–º–µ—Ä –±–∏–ª–µ—Ç–∞:</span>
                  <span class="value code">{{ ticket.ticketCode }}</span>
                </div>
                
                <div class="seat-info">
                  <span class="label">–ú–µ—Å—Ç–æ:</span>
                  <span class="value seat">
                    –†—è–¥ {{ getSeatInfo(ticket.seatId).row }}, 
                    –ú–µ—Å—Ç–æ {{ getSeatInfo(ticket.seatId).number }}
                    <span class="seat-type">({{ getSeatInfo(ticket.seatId).type }})</span>
                  </span>
                </div>
                
                <div class="price-info">
                  <span class="label">–°—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                  <span class="value price">{{ ticket.price }} ‚ÇΩ</span>
                </div>
                
                <div class="booking-info">
                  <span class="label">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Ññ:</span>
                  <span class="value">{{ booking.bookingId }}</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- –í—Å–µ –º–µ—Å—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–∏–ª–µ—Ç–æ–≤) -->
          @if (getAllTickets().length > 0) {
            <div class="all-tickets">
              <h4>–í—Å–µ –º–µ—Å—Ç–∞ –≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏:</h4>
              <div class="tickets-list">
                @for (t of getAllTickets(); track t.ticketId) {
                  <div class="ticket-item" [class.current]="t.ticketId === ticket.ticketId">
                    <span class="ticket-code">{{ t.ticketCode }}</span>
                    <span class="ticket-seat">
                      –†—è–¥ {{ getSeatInfo(t.seatId).row }}, –ú–µ—Å—Ç–æ {{ getSeatInfo(t.seatId).number }}
                    </span>
                    <span class="ticket-price">{{ t.price }} ‚ÇΩ</span>
                  </div>
                }
              </div>
              <p class="total-price">–ò—Ç–æ–≥–æ: <strong>{{ booking.totalCost }} ‚ÇΩ</strong></p>
            </div>
          }
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø–µ—á–∞—Ç–∏ -->
        <div class="print-info">
          <p><strong>–í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong></p>
          <ul>
            <li>–ü—Ä–∏—Ö–æ–¥–∏—Ç–µ –∑–∞ 15 –º–∏–Ω—É—Ç –¥–æ –Ω–∞—á–∞–ª–∞ —Å–µ–∞–Ω—Å–∞</li>
            <li>–ò–º–µ—Ç—å –ø—Ä–∏ —Å–µ–±–µ –¥–æ–∫—É–º–µ–Ω—Ç, —É–¥–æ—Å—Ç–æ–≤–µ—Ä—è—é—â–∏–π –ª–∏—á–Ω–æ—Å—Ç—å</li>
            <li>–î–µ—Ç–∏ –¥–æ 12 –ª–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–∏ –≤–∑—Ä–æ—Å–ª—ã—Ö</li>
            <li>–í–æ–∑–≤—Ä–∞—Ç –±–∏–ª–µ—Ç–æ–≤ –≤–æ–∑–º–æ–∂–µ–Ω –∑–∞ 3 —á–∞—Å–∞ –¥–æ —Å–µ–∞–Ω—Å–∞</li>
            <li>QR-–∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–æ—Ä–æ—à–æ –≤–∏–¥–µ–Ω –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏</li>
          </ul>
        </div>
        
        <!-- –î–µ–π—Å—Ç–≤–∏—è —Å –±–∏–ª–µ—Ç–æ–º -->
        @if (!isPrintMode) {
          <div class="ticket-actions">
            <div class="actions-left">
              <button class="btn" (click)="printTicket()">
                üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –±–∏–ª–µ—Ç
              </button>
              <button class="btn btn-outline" (click)="downloadPdf()">
                üì• –°–∫–∞—á–∞—Ç—å PDF
              </button>
            </div>
            
            <div class="actions-right">
              @if (booking.status === 'active' && canCancel()) {
                <button class="btn btn-danger" (click)="cancelBooking()">
                  ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                </button>
              }
              <a class="btn btn-outline" routerLink="/">
                üé¨ –ù–∞ –≥–ª–∞–≤–Ω—É—é
              </a>
            </div>
          </div>
        }
      </div>
    }
    
    <!-- –î–µ–º–æ-—Å–æ–æ–±—â–µ–Ω–∏–µ -->
    @if (!ticket && !isLoading && !errorMessage) {
      <div class="demo-message">
        <h2>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –±–∏–ª–µ—Ç</h2>
        <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –±–∏–ª–µ—Ç –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏.</p>
        <div class="demo-actions">
          <button class="btn" (click)="showDemoTicket()">
            –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ–º–æ-–±–∏–ª–µ—Ç
          </button>
          <a class="btn btn-outline" routerLink="/">
            –í—ã–±—Ä–∞—Ç—å —Ñ–∏–ª—å–º
          </a>
        </div>
      </div>
    }
  </div>
</div>

<!-- –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—á–∞—Ç–∏ -->
<style>
@media print {
  .ticket-page {
    background: white !important;
  }
  
  .page-header,
  .ticket-actions,
  .back-btn,
  .demo-message {
    display: none !important;
  }
  
  .ticket-main {
    border: 2px solid #000 !important;
    box-shadow: none !important;
  }
  
  .print-info {
    page-break-inside: avoid;
  }
}
</style>